<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tryMe Editor</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/editor.css">
</head>
<body>

<div class="editor-layout" id="editor-layout">

    <!-- TOP BAR -->
    <div class="editor-topbar">
        <div class="topbar-left">
            <a href="/" class="back-link">‚Üê All Demos</a>
            <div class="separator" style="width:1px;height:20px;background:var(--border-light);"></div>
            <input type="text" class="demo-title-input" id="demo-title-input"
                   placeholder="Untitled Demo" value=""
                   onblur="editor.saveDemoTitle(this.value)">
        </div>
        <div class="topbar-right">
            <span class="step-counter" id="step-counter">0 steps</span>
            <button class="btn btn-ghost btn-sm" onclick="editor.openSettings()">‚öô Settings</button>
            <button class="btn btn-secondary btn-sm" onclick="editor.copyViewerLink()">üîó Copy Link</button>
            <a id="preview-btn" class="btn btn-primary btn-sm" href="#" target="_blank">‚ñ∂ Preview</a>
        </div>
    </div>

    <!-- LEFT: Step list -->
    <div class="step-sidebar">
        <div class="step-sidebar-header">Steps</div>
        <div class="step-list" id="step-list">
            <!-- populated by JS -->
        </div>
        <div class="step-sidebar-footer">
            <button class="btn btn-primary" style="width:100%;" onclick="editor.addStep()">+ Add Step</button>
            <label class="btn btn-secondary bulk-upload-btn" for="bulk-upload" title="Select multiple screenshots to create steps in one go" style="width:100%;margin-top:8px;justify-content:center;cursor:pointer;">
                üìÇ Bulk Import Screenshots
            </label>
            <input type="file" id="bulk-upload" accept="image/*" multiple style="display:none"
                   onchange="editor.handleBulkUpload(this)">
        </div>
    </div>

    <!-- CENTER: Canvas editor -->
    <div class="canvas-area">
        <div class="canvas-toolbar">
            <!-- Step title lives here ‚Äî always visible, top of the editing area -->
            <input type="text" class="toolbar-step-title" id="step-title-input"
                   placeholder="Step title‚Ä¶" title="Step title">
            <div class="separator"></div>
            <label class="upload-label disabled" id="toolbar-upload-label" for="screenshot-upload" title="Select a step first">
                üì∑ Replace Screenshot
            </label>
            <input type="file" id="screenshot-upload" accept="image/*" style="display:none"
                   onchange="editor.handleScreenshotUpload(this)">
            <div class="separator"></div>
            <button class="tool-btn active" id="tool-draw" onclick="editor.setTool('draw')" title="Draw hotspot">
                ‚úè Draw Hotspot
            </button>
            <button class="tool-btn" id="tool-select" onclick="editor.setTool('select')" title="Select hotspot">
                ‚Üñ Select
            </button>
            <div class="separator"></div>
            <span class="hint-text" id="canvas-hint">Click and drag on the screenshot to add a hotspot</span>
        </div>

        <div class="canvas-viewport" id="canvas-viewport">
            <div class="no-screenshot" id="no-screenshot">
                <div class="icon">üì∏</div>
                <p id="no-screenshot-msg">Add a step first, then upload a screenshot</p>
                <label class="btn btn-primary" id="no-screenshot-upload-btn" for="screenshot-upload" style="display:none">Upload Screenshot</label>
            </div>
            <!-- Banner preview lives inside canvas-container so its left/top share
                 the same coordinate space as hotspot canvas fractions -->
            <div class="canvas-container" id="canvas-container" style="display:none;">
                <img id="canvas-img" src="" alt="Step screenshot" draggable="false">
                <canvas id="hotspot-canvas"></canvas>
                <div class="editor-banner-preview" id="editor-banner-preview" style="display:none;">
                    <div class="editor-banner-body">
                        <span id="editor-banner-text"></span>
                        <button class="editor-banner-cta" id="editor-banner-cta" tabindex="-1"></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step meta bar -->
        <div class="step-meta-bar">

            <!-- Col 1: Banner copy with rich-text toolbar -->
            <div class="field-group banner-copy-group">
                <label>Banner copy</label>
                <!-- Formatting toolbar -->
                <div class="rte-toolbar" id="rte-toolbar">
                    <button type="button" class="rte-btn" data-cmd="bold"        title="Bold">B</button>
                    <button type="button" class="rte-btn" data-cmd="italic"      title="Italic"><em>I</em></button>
                    <button type="button" class="rte-btn" data-cmd="insertUnorderedList" title="Bullets">‚ò∞</button>
                    <div class="rte-sep"></div>
                    <button type="button" class="rte-btn" data-cmd="justifyLeft"   title="Left">‚á§</button>
                    <button type="button" class="rte-btn" data-cmd="justifyCenter" title="Center">‚â°</button>
                    <button type="button" class="rte-btn" data-cmd="justifyRight"  title="Right">‚á•</button>
                    <div class="rte-sep"></div>
                    <!-- Brand colour swatches -->
                    <button type="button" class="rte-color" style="background:#ffffff;" data-color="#ffffff" title="White"></button>
                    <button type="button" class="rte-color" style="background:#e91e8c;" data-color="#e91e8c" title="Pink"></button>
                    <button type="button" class="rte-color" style="background:#0dcaff;" data-color="#0dcaff" title="Cyan"></button>
                    <button type="button" class="rte-color" style="background:#8b7eef;" data-color="#8b7eef" title="Purple"></button>
                    <button type="button" class="rte-color" style="background:#b0b8d0;" data-color="#b0b8d0" title="Muted"></button>
                </div>
                <div id="step-tooltip-input"
                     class="rte-editor"
                     contenteditable="true"
                     data-placeholder="What should the viewer do here?"
                     oninput="editor._updateEditorBanner()"></div>
                <!-- Hidden sync field for plain-text fallback -->
                <textarea id="step-tooltip-plain" style="display:none;"></textarea>
            </div>

            <!-- Col 2: CTA + anchor -->
            <div class="field-group">
                <label>Banner CTA label</label>
                <input type="text" id="banner-cta-label" placeholder="e.g. Next ‚Üí" oninput="editor._updateEditorBanner()">
                <select id="banner-cta-action" onchange="editor._toggleBannerCtaTarget(this.value); editor._updateEditorBanner();" style="margin-top:4px;">
                    <option value="next">‚Üí Next step</option>
                    <option value="goto">‚§µ Specific step</option>
                </select>
                <div class="field-group" id="banner-cta-target-group" style="display:none;margin-top:4px;">
                    <select id="banner-cta-target"></select>
                </div>
                <label style="margin-top:8px;">Anchor to hotspot</label>
                <select id="banner-hotspot-anchor" onchange="editor._updateEditorBanner()" style="margin-top:2px;">
                    <option value="">‚Äî Float (top-center) ‚Äî</option>
                </select>
            </div>

            <!-- Col 3: Pointer + save -->
            <div class="field-group">
                <label>Pointer side</label>
                <select id="banner-pointer" onchange="editor._updateEditorBanner()">
                    <option value="none">None</option>
                    <option value="bottom">‚Üì Bottom</option>
                    <option value="top">‚Üë Top</option>
                    <option value="left">‚Üê Left</option>
                    <option value="right">‚Üí Right</option>
                </select>
            </div>
            <button class="btn btn-primary save-step-btn" onclick="editor.saveStepMeta()">üíæ Save Step</button>

            <input type="hidden" id="step-notes-input" value="">
        </div>
    </div>

    <!-- RIGHT: Hotspot panel -->
    <div class="hotspot-panel">
        <div class="hotspot-panel-header">
            <div class="hotspot-panel-title">Hotspots</div>
            <span id="hotspot-count" style="font-size:12px;color:var(--text-muted);">0</span>
        </div>
        <div class="hotspot-list-section" id="hotspot-list">
            <!-- populated by JS -->
        </div>
    </div>

</div>

<!-- Demo Settings Modal -->
<div class="modal-overlay" id="settings-modal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Demo Settings</div>
            <button class="modal-close" onclick="editor.closeSettings()">√ó</button>
        </div>
        <div class="field-group">
            <label>Title</label>
            <input type="text" id="settings-title" placeholder="Demo title">
        </div>
        <div class="field-group">
            <label>Description</label>
            <textarea id="settings-desc" placeholder="What does this demo show?"></textarea>
        </div>
        <div class="field-group">
            <label>Target Personas</label>
            <div class="persona-tags" id="settings-personas"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="editor.closeSettings()">Cancel</button>
            <button class="btn btn-primary" onclick="editor.saveSettings()">Save Settings</button>
        </div>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script src="/static/js/editor.js"></script>
</body>
</html>
